<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم تشخیص پزشکی</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #ddd;
            margin-left: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background: #4CAF50;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 0 0 5px 5px;
        }
        .tab-content.active {
            display: block;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .success {
            background: #dff0d8;
            color: #3c763d;
        }
        .error {
            background: #f2dede;
            color: #a94442;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>سیستم تشخیص پزشکی یکپارچه</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="openTab('breast')">سرطان پستان</div>
            <div class="tab" onclick="openTab('diabetes')">دیابت</div>
            <div class="tab" onclick="openTab('heart')">بیماری قلبی</div>
        </div>
        
        <!-- سرطان پستان -->
        <div id="breast" class="tab-content active">
            <h2>تشخیص سرطان پستان</h2>
            <button onclick="trainModel('breast')">آموزش مدل</button>
            <div id="breast-train-result" class="result"></div>
            
            <h3>ورودی‌های تشخیص</h3>
            <form id="breast-form">
                <div class="form-group">
                    <label for="breast-radius_mean">میانگین شعاع:</label>
                    <input type="number" step="0.01" id="breast-radius_mean" required>
                </div>
                <div class="form-group">
                    <label for="breast-texture_mean">میانگین بافت:</label>
                    <input type="number" step="0.01" id="breast-texture_mean" required>
                </div>
                <!-- سایر فیلدهای مورد نیاز -->
                <button type="button" onclick="predictDisease('breast')">تشخیص</button>
            </form>
            <div id="breast-result" class="result"></div>
        </div>
        
        <!-- دیابت -->
        <div id="diabetes" class="tab-content">
            <h2>تشخیص دیابت</h2>
            <button onclick="trainModel('diabetes')">آموزش مدل</button>
            <div id="diabetes-train-result" class="result"></div>
            
            <h3>ورودی‌های تشخیص</h3>
            <form id="diabetes-form">
                <div class="form-group">
                    <label for="diabetes-pregnancies">تعداد بارداری‌ها:</label>
                    <input type="number" id="diabetes-pregnancies" required>
                </div>
                <div class="form-group">
                    <label for="diabetes-glucose">گلوکز (mg/dl):</label>
                    <input type="number" id="diabetes-glucose" required>
                </div>
                <!-- سایر فیلدهای مورد نیاز -->
                <button type="button" onclick="predictDisease('diabetes')">تشخیص</button>
            </form>
            <div id="diabetes-result" class="result"></div>
        </div>
        
        <!-- بیماری قلبی -->
        <div id="heart" class="tab-content">
            <h2>تشخیص بیماری قلبی</h2>
            <button onclick="trainModel('heart')">آموزش مدل</button>
            <div id="heart-train-result" class="result"></div>
            
            <h3>ورودی‌های تشخیص</h3>
            <form id="heart-form">
                <div class="form-group">
                    <label for="heart-age">سن (سال):</label>
                    <input type="number" id="heart-age" required>
                </div>
                <div class="form-group">
                    <label for="heart-sex">جنسیت:</label>
                    <select id="heart-sex" required>
                        <option value="0">زن</option>
                        <option value="1">مرد</option>
                    </select>
                </div>
                <!-- سایر فیلدهای مورد نیاز -->
                <button type="button" onclick="predictDisease('heart')">تشخیص</button>
            </form>
            <div id="heart-result" class="result"></div>
        </div>
    </div>

    <script>
        function openTab(tabName) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Deactivate all tabs
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Activate the selected tab and content
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        function trainModel(modelType) {
            const resultDiv = document.getElementById(`${modelType}-train-result`);
            resultDiv.style.display = 'none';
            
            fetch(`/train/${modelType}`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `خطا: ${data.error}`;
                } else {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `مدل با موفقیت آموزش داده شد. دقت: ${(data.accuracy * 100).toFixed(2)}%`;
                }
                resultDiv.style.display = 'block';
            })
            .catch(error => {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `خطا در ارتباط با سرور: ${error}`;
                resultDiv.style.display = 'block';
            });
        }
        
        function predictDisease(modelType) {
            const form = document.getElementById(`${modelType}-form`);
            const resultDiv = document.getElementById(`${modelType}-result`);
            resultDiv.style.display = 'none';
            
            // جمع‌آوری داده‌های فرم
            const inputs = form.querySelectorAll('input, select');
            const inputData = {};
            
            inputs.forEach(input => {
                const fieldName = input.id.replace(`${modelType}-`, '');
                inputData[fieldName] = input.value;
            });
            
            // ارسال درخواست به سرور
            fetch(`/predict/${modelType}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(inputData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `خطا: ${data.error}`;
                } else {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <h3>نتایج تشخیص:</h3>
                        <p>تشخیص: ${data.diagnosis}</p>
                        <p>احتمال: ${(data.probability * 100).toFixed(1)}%</p>
                        <p>آستانه تشخیص: ${data.threshold}</p>
                    `;
                }
                resultDiv.style.display = 'block';
            })
            .catch(error => {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `خطا در ارتباط با سرور: ${error}`;
                resultDiv.style.display = 'block';
            });
        }
    </script>
</body>
</html>