<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم تشخیص پزشکی - پیش‌بینی</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/font.css" rel="stylesheet">
    <style>
        body {
            font-family: Vazirmatn, sans-serif;
            background-color: #f8f9fa;
        }
        .nav-link {
            font-weight: 500;
        }
        .tab-content {
            padding: 20px;
            background: white;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }
        .feature-group {
            margin-bottom: 1rem;
        }
        .result-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
        }
        .form-control, .form-select {
            direction: ltr;
            text-align: right;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">سیستم تشخیص پزشکی</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="/">پیش‌بینی</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/train">آموزش مدل</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h2 class="text-center">سیستم تشخیص پزشکی یکپارچه</h2>
            </div>
            
            <div class="card-body">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="breast-tab" data-bs-toggle="tab" data-bs-target="#breast" type="button">سرطان پستان</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="diabetes-tab" data-bs-toggle="tab" data-bs-target="#diabetes" type="button">دیابت</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="heart-tab" data-bs-toggle="tab" data-bs-target="#heart" type="button">بیماری قلبی</button>
                    </li>
                </ul>
                
                <div class="tab-content" id="myTabContent">
                    <!-- سرطان پستان -->
                    <div class="tab-pane fade show active" id="breast">
                        <h3 class="mt-3">تشخیص سرطان پستان</h3>
                        <p class="text-muted">لطفاً مقادیر ویژگی‌های مورد نیاز را وارد کنید:</p>
                        
                        <form id="breast-form">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="radius_mean" class="form-label">میانگین شعاع</label>
                                        <input type="number" step="0.001" class="form-control" id="radius_mean" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="texture_mean" class="form-label">میانگین بافت</label>
                                        <input type="number" step="0.001" class="form-control" id="texture_mean" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="perimeter_mean" class="form-label">میانگین محیط</label>
                                        <input type="number" step="0.001" class="form-control" id="perimeter_mean" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="area_mean" class="form-label">میانگین مساحت</label>
                                        <input type="number" step="0.001" class="form-control" id="area_mean" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="smoothness_mean" class="form-label">میانگین صافی</label>
                                        <input type="number" step="0.000001" class="form-control" id="smoothness_mean" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="compactness_mean" class="form-label">میانگین تراکم</label>
                                        <input type="number" step="0.000001" class="form-control" id="compactness_mean" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="concavity_mean" class="form-label">میانگین تقعر</label>
                                        <input type="number" step="0.000001" class="form-control" id="concavity_mean" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="concave_points_mean" class="form-label">میانگین نقاط مقعر</label>
                                        <input type="number" step="0.000001" class="form-control" id="concave_points_mean" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="symmetry_mean" class="form-label">میانگین تقارن</label>
                                        <input type="number" step="0.000001" class="form-control" id="symmetry_mean" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="fractal_dimension_mean" class="form-label">میانگین بعد فراکتال</label>
                                        <input type="number" step="0.000001" class="form-control" id="fractal_dimension_mean" required>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary mt-3" onclick="predictDisease('breast')">تشخیص</button>
                        </form>
                        <div id="breast-result" class="result-box alert mt-3" style="display: none;"></div>
                    </div>
                    
                    <!-- دیابت -->
                    <div class="tab-pane fade" id="diabetes">
                        <h3 class="mt-3">تشخیص دیابت</h3>
                        <p class="text-muted">لطفاً اطلاعات بیمار را وارد کنید:</p>
                        
                        <form id="diabetes-form">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="Pregnancies" class="form-label">تعداد بارداری‌ها</label>
                                        <input type="number" class="form-control" id="Pregnancies" min="0" max="20" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="Glucose" class="form-label">گلوکز (mg/dl)</label>
                                        <input type="number" class="form-control" id="Glucose" min="0" max="200" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="BloodPressure" class="form-label">فشار خون (mmHg)</label>
                                        <input type="number" class="form-control" id="BloodPressure" min="0" max="150" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="SkinThickness" class="form-label">ضخامت پوست (mm)</label>
                                        <input type="number" class="form-control" id="SkinThickness" min="0" max="100" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="Insulin" class="form-label">انسولین (muU/ml)</label>
                                        <input type="number" class="form-control" id="Insulin" min="0" max="900" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="BMI" class="form-label">شاخص توده بدنی</label>
                                        <input type="number" step="0.1" class="form-control" id="BMI" min="0" max="70" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="DiabetesPedigreeFunction" class="form-label">سابقه خانوادگی</label>
                                        <input type="number" step="0.001" class="form-control" id="DiabetesPedigreeFunction" min="0" max="3" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="Age" class="form-label">سن (سال)</label>
                                        <input type="number" class="form-control" id="Age" min="0" max="120" required>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary mt-3" onclick="predictDisease('diabetes')">تشخیص</button>
                        </form>
                        <div id="diabetes-result" class="result-box alert mt-3" style="display: none;"></div>
                    </div>
                    
                    <!-- بیماری قلبی -->
                    <div class="tab-pane fade" id="heart">
                        <h3 class="mt-3">تشخیص بیماری قلبی</h3>
                        <p class="text-muted">لطفاً اطلاعات بیمار را وارد کنید:</p>
                        
                        <form id="heart-form">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="age" class="form-label">سن (سال)</label>
                                        <input type="number" class="form-control" id="age" min="0" max="120" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="sex" class="form-label">جنسیت</label>
                                        <select class="form-select" id="sex" required>
                                            <option value="0">زن</option>
                                            <option value="1">مرد</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="cp" class="form-label">نوع درد قفسه سینه</label>
                                        <select class="form-select" id="cp" required>
                                            <option value="0">نوع 0</option>
                                            <option value="1">نوع 1</option>
                                            <option value="2">نوع 2</option>
                                            <option value="3">نوع 3</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="trestbps" class="form-label">فشار خون (mmHg)</label>
                                        <input type="number" class="form-control" id="trestbps" min="0" max="250" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="chol" class="form-label">کلسترول (mg/dl)</label>
                                        <input type="number" class="form-control" id="chol" min="0" max="600" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="fbs" class="form-label">قند خون ناشتا</label>
                                        <select class="form-select" id="fbs" required>
                                            <option value="0">≤120 mg/dl</option>
                                            <option value="1">>120 mg/dl</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="restecg" class="form-label">نتیجه ECG استراحت</label>
                                        <select class="form-select" id="restecg" required>
                                            <option value="0">نرمال</option>
                                            <option value="1">ناهنجاری موج ST-T</option>
                                            <option value="2">هیپرتروفی بطن چپ</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="thalach" class="form-label">حداکثر ضربان قلب</label>
                                        <input type="number" class="form-control" id="thalach" min="0" max="250" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="exang" class="form-label">آنژین القا شده</label>
                                        <select class="form-select" id="exang" required>
                                            <option value="0">خیر</option>
                                            <option value="1">بله</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="oldpeak" class="form-label">افسردگی ST</label>
                                        <input type="number" step="0.1" class="form-control" id="oldpeak" min="0" max="10" required>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="slope" class="form-label">شیب ST</label>
                                        <select class="form-select" id="slope" required>
                                            <option value="0">صعودی</option>
                                            <option value="1">مسطح</option>
                                            <option value="2">نزولی</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="ca" class="form-label">تعداد عروق اصلی</label>
                                        <select class="form-select" id="ca" required>
                                            <option value="0">0</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="feature-group">
                                        <label for="thal" class="form-label">نتیجه تالاسیمی</label>
                                        <select class="form-select" id="thal" required>
                                            <option value="0">نرمال</option>
                                            <option value="1">نقص ثابت</option>
                                            <option value="2">نقص برگشت‌پذیر</option>
                                            <option value="3">سایر</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary mt-3" onclick="predictDisease('heart')">تشخیص</button>
                        </form>
                        <div id="heart-result" class="result-box alert mt-3" style="display: none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // پیش‌بینی بیماری
        function predictDisease(modelType) {
            const form = document.getElementById(`${modelType}-form`);
            const resultDiv = document.getElementById(`${modelType}-result`);
            resultDiv.style.display = 'none';
            
            // جمع‌آوری داده‌های فرم
            const inputData = {};
            let isValid = true;
            
            const inputs = form.querySelectorAll('input, select');
            inputs.forEach(input => {
                if (input.required && !input.value) {
                    input.classList.add('is-invalid');
                    isValid = false;
                } else {
                    input.classList.remove('is-invalid');
                    inputData[input.id] = input.value;
                }
            });
            
            if (!isValid) {
                resultDiv.className = 'alert-danger';
                resultDiv.innerHTML = '<strong>خطا:</strong> لطفاً تمام فیلدهای ضروری را پر کنید.';
                resultDiv.style.display = 'block';
                return;
            }
            
            // ارسال درخواست به سرور
            fetch(`/predict/${modelType}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(inputData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('خطا در ارتباط با سرور');
                }
                return response.json();
            })
            .then(data => {
                if (data.error) {
                    resultDiv.className = 'alert-danger';
                    resultDiv.innerHTML = `<strong>خطا:</strong> ${data.error}`;
                } else {
                    resultDiv.className = 'alert-success';
                    resultDiv.innerHTML = `
                        <h4>نتایج تشخیص:</h4>
                        <p><strong>تشخیص:</strong> ${data.diagnosis}</p>
                        <p><strong>احتمال:</strong> ${(data.probability * 100).toFixed(1)}%</p>
                        <p><strong>آستانه تشخیص:</strong> ${data.threshold}</p>
                    `;
                }
                resultDiv.style.display = 'block';
            })
            .catch(error => {
                resultDiv.className = 'alert-danger';
                resultDiv.innerHTML = `<strong>خطا:</strong> ${error.message}`;
                resultDiv.style.display = 'block';
            });
        }
    </script>
</body>
</html>